<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#ffffff" />
  <title>å¥åº·æ‰“å¡ï½œæ•ˆç‡ä¼˜å…ˆ</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <style>
    :root{
      --bg:#ffffff; --fg:#111827; --muted:#6b7280; --line:#e5e7eb;
      --card:#fafafa; --ok:#16a34a; --warn:#f59e0b; --bad:#ef4444;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text","PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;
      color:var(--fg); background:linear-gradient(180deg,#fff,#fbfbfb);
    }
    .wrap{max-width:860px; margin:0 auto; padding:20px 16px 40px}
    header{
      display:flex; align-items:flex-end; justify-content:space-between; gap:12px;
      padding:10px 2px 6px;
    }
    h1{font-size:22px; margin:0; letter-spacing:0.2px}
    .sub{font-size:12px; color:var(--muted)}
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 12px; border:1px solid var(--line); border-radius:999px; background:#fff;
      font-size:12px;
    }
    .grid{display:grid; grid-template-columns:1.1fr 0.9fr; gap:12px; margin-top:12px}
    @media (max-width:860px){ .grid{grid-template-columns:1fr} }
    .card{
      background:var(--card); border:1px solid var(--line); border-radius:var(--radius);
      padding:14px; box-shadow:0 1px 0 rgba(17,24,39,.03);
    }
    .card h2{margin:0 0 10px; font-size:16px}
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 8px; border-radius:14px}
    .row + .row{margin-top:6px}
    .row label{display:flex; gap:10px; align-items:center; font-size:14px}
    input[type="checkbox"]{width:20px; height:20px}
    .meta{font-size:12px; color:var(--muted)}
    .kpi{
      display:flex; flex-wrap:wrap; gap:8px; margin-top:8px
    }
    .kpi .pill strong{font-size:12px}
    .btns{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    button{
      border:1px solid var(--line); background:#fff; padding:10px 12px; border-radius:14px;
      font-size:13px; cursor:pointer;
    }
    button.primary{background:#111827; color:#fff; border-color:#111827}
    button.danger{border-color:#fecaca; background:#fff5f5; color:#991b1b}
    .small{font-size:12px; color:var(--muted)}
    select, input[type="time"], input[type="number"], textarea{
      width:100%; border:1px solid var(--line); border-radius:14px; padding:10px 12px; background:#fff;
      font-size:14px;
    }
    textarea{min-height:92px; resize:vertical}
    .two{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width:520px){ .two{grid-template-columns:1fr} }
    .tag{
      display:inline-flex; align-items:center; gap:6px; padding:3px 8px; border-radius:999px; font-size:12px;
      border:1px solid var(--line); background:#fff;
    }
    .tag.ok{border-color:#bbf7d0; background:#f0fdf4; color:#166534}
    .tag.warn{border-color:#fde68a; background:#fffbeb; color:#92400e}
    .tag.bad{border-color:#fecaca; background:#fff1f2; color:#9f1239}
    .hr{height:1px; background:var(--line); margin:10px 0}
    .list{margin:0; padding-left:18px; color:var(--muted); font-size:13px}
    .spark{
      display:flex; gap:4px; align-items:flex-end; height:44px; margin-top:8px
    }
    .bar{width:10px; border-radius:6px; background:#e5e7eb}
    .bar.on{background:#111827}
    .footer{margin-top:14px; text-align:center; color:var(--muted); font-size:12px}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>å¥åº·æ‰“å¡ï½œæ•ˆç‡ä¼˜å…ˆ</h1>
        <div class="sub">ç›®æ ‡ï¼šå¥åº·ç”Ÿæ´»ï¼</div>
      </div>
      <div class="pill"><span id="todayLabel">â€”</span> <span class="mono" id="streak">Streak: 0</span></div>
    </header>

    <div class="grid">
      <section class="card">
        <h2>ä»Šæ—¥æ‰§è¡Œæ¸…å•ï¼ˆ5 é¡¹ï¼‰</h2>
        <div class="row"><label><input id="c1" type="checkbox"/>åƒäº†æ—©é¤ï¼ˆå«è›‹ç™½ï¼‰</label><span class="meta">é˜²ç©ºè…¹å¿«ç³–</span></div>
        <div class="row"><label><input id="c2" type="checkbox"/>åˆé¤æœ‰ä¸»é£Ÿ + è›‹ç™½</label><span class="meta">ç¨³èƒ½é‡</span></div>
        <div class="row"><label><input id="c3" type="checkbox"/>å’–å•¡ â‰¤ 1 æ¯ï¼ˆä¸”ä¸ç©ºè…¹ï¼‰</label><span class="meta">ç¨³ä¹³è…º/ç”²çŠ¶è…º</span></div>
        <div class="row"><label><input id="c4" type="checkbox"/>é¥®æ°´ â‰¥ 2 Lï¼ˆåˆ†æ¬¡ï¼‰</label><span class="meta">é˜²è‚¾ç»“æ™¶</span></div>
        <div class="row"><label><input id="c5" type="checkbox"/>00:30 å‰èººä¸‹</label><span class="meta">ç¨³TSH</span></div>

        <div class="kpi">
          <span class="pill"><strong id="score">0/5</strong>&nbsp;å®Œæˆ</span>
          <span class="pill">çŠ¶æ€ï¼š<span id="statusTag" class="tag">â€”</span></span>
          <span class="pill">è¿‘ 7 å¤©ï¼š<span id="weekScore" class="mono">â€”</span></span>
        </div>

        <div class="spark" id="spark"></div>

        <div class="btns">
          <button class="primary" id="saveBtn">ä¿å­˜ä»Šæ—¥</button>
          <button id="prevBtn">â† æ˜¨å¤©</button>
          <button id="nextBtn">æ˜å¤© â†’</button>
          <button id="todayBtn">å›åˆ°ä»Šå¤©</button>
        </div>
        <div class="small">æç¤ºï¼šiPhone ä¸Šå¯ç”¨ Safari æ‰“å¼€æ­¤é¡µé¢åï¼Œç‚¹ã€Œåˆ†äº«ã€â†’ã€Œæ·»åŠ åˆ°ä¸»å±å¹•ã€å®ç°åƒ App ä¸€æ ·æ‰“å¡ã€‚</div>
      </section>

      <aside class="card">
        <h2>ç¨³èƒ½é‡è®°å½•ï¼ˆå¯é€‰ï¼Œä½†å¾ˆæœ‰ç”¨ï¼‰</h2>
        <div class="two">
          <div>
            <div class="meta">ä»Šæ—¥ä¸»é£Ÿç±»å‹</div>
            <select id="carbType">
              <option value="">ï¼ˆæœªè®°å½•ï¼‰</option>
              <option value="slow">æ…¢ç¢³æ°´ï¼ˆæ‚ç²®é¥­/çº¢è–¯/åŸç‰‡ç‡•éº¦/ç‰ç±³ï¼‰</option>
              <option value="mixed">æ··åˆï¼ˆå°‘é‡ç™½ç±³/é¢ + è›‹ç™½è”¬èœï¼‰</option>
              <option value="fast">å¿«ç¢³æ°´ï¼ˆç™½ç±³/ç™½é¢/ç”œç‚¹ï¼‰</option>
            </select>
          </div>
          <div>
            <div class="meta">é¤åçŠ¶æ€</div>
            <select id="postMeal">
              <option value="">ï¼ˆæœªè®°å½•ï¼‰</option>
              <option value="good">ç²¾åŠ›å¹³ç¨³</option>
              <option value="sleepy">çŠ¯å›°</option>
              <option value="unwell">éš¾å—/å¿ƒæ…Œ</option>
            </select>
          </div>
        </div>

        <div style="margin-top:10px" class="two">
          <div>
            <div class="meta">æµ·å¸¦/é«˜ç¢˜é£Ÿç‰©</div>
            <select id="seaweed">
              <option value="">ï¼ˆæœªè®°å½•ï¼‰</option>
              <option value="no">æ²¡æœ‰</option>
              <option value="small">å°‘é‡ï¼ˆâ‰¤1æ¬¡/å‘¨ï¼‰</option>
              <option value="more">è¾ƒå¤š/è¿ç»­</option>
            </select>
          </div>
          <div>
            <div class="meta">é¥®æ°´ï¼ˆLï¼‰</div>
            <input id="water" type="number" inputmode="decimal" min="0" max="5" step="0.1" placeholder="ä¾‹å¦‚ 2.0" />
          </div>
        </div>

        <div style="margin-top:10px" class="two">
          <div>
            <div class="meta">ä¸ŠåºŠæ—¶é—´</div>
            <input id="bedtime" type="time" />
          </div>
          <div>
            <div class="meta">å’–å•¡æ¯æ•°</div>
            <input id="coffee" type="number" min="0" max="6" step="1" placeholder="ä¾‹å¦‚ 1" />
          </div>
        </div>

        <div style="margin-top:10px">
          <div class="meta">å¤‡æ³¨ï¼ˆå¯å†™â€œä»Šæ—¥è§¦å‘ç‚¹/ç»å‰/å‹åŠ›/è¿åŠ¨â€ï¼‰</div>
          <textarea id="note" placeholder="ä¾‹å¦‚ï¼šåˆé¤åƒäº†é¢ï¼Œ30åˆ†é’ŸåçŠ¯å›°ï¼›ä»Šå¤©èµ°è·¯20åˆ†é’Ÿ"></textarea>
        </div>

        <div class="hr"></div>
        <h2>ä½ çš„å…³é”®è§„åˆ™ï¼ˆå›ºå®šï¼‰</h2>
        <ul class="list">
          <li>ä¸»é£Ÿä¼˜å…ˆé€‰ï¼šæ‚ç²®é¥­(1:1)ã€çº¢è–¯/ç´«è–¯ã€åŸç‰‡ç‡•éº¦ã€ç‰ç±³ã€‚</li>
          <li>ç™½ç±³/ç™½é¢ï¼šå¯ä»¥åƒï¼Œä½†â€œå‡åŠ + å…ˆåƒè›‹ç™½è”¬èœâ€ã€‚</li>
          <li>æµ·å¸¦ï¼šâ‰¤1æ¬¡/å‘¨ã€å°‘é‡ã€ä¸è¿ç»­ï¼›ä¸å åŠ ç´«èœ/ç¢˜ç‰‡ã€‚</li>
          <li>æ¯å¤©ï¼šé¥®æ°´ â‰¥2Lï¼›ä¸æ†‹å°¿ã€‚</li>
          <li>ç¡çœ ï¼šå›ºå®šèµ·åºŠï¼›23:30 å‰èººä¸‹ä¼˜å…ˆçº§æœ€é«˜ã€‚</li>
        </ul>

        <div class="btns" style="margin-top:12px">
          <button id="exportBtn">å¯¼å‡ºæ•°æ®(JSON)</button>
          <button id="importBtn">å¯¼å…¥æ•°æ®(JSON)</button>
          <button class="danger" id="resetBtn">æ¸…ç©ºæœ¬æœºæ•°æ®</button>
        </div>
        <input id="fileInput" type="file" accept="application/json" style="display:none"/>
        <div class="footer">æœ¬å·¥å…·ä»…ç”¨äºè‡ªæˆ‘ç®¡ç†ï¼Œä¸æ›¿ä»£åŒ»ç”Ÿè¯Šæ–­ã€‚</div>
      </aside>
    </div>
  </div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);
  const tzOffsetMin = new Date().getTimezoneOffset();

  function yyyy_mm_dd(d){
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,'0');
    const da = String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${da}`;
  }
  function parseDate(s){
    const [y,m,d] = s.split('-').map(Number);
    return new Date(y, m-1, d);
  }
  function addDays(date, n){
    const d = new Date(date); d.setDate(d.getDate()+n); return d;
  }

  const STORAGE_KEY = "health_checkin_v1";
  function loadAll(){
    try { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}"); }
    catch(e){ return {}; }
  }
  function saveAll(obj){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
  }

  let cursor = new Date();
  let data = loadAll();

  function getDay(key){
    return data[key] || {checks:[false,false,false,false,false], meta:{}, savedAt:null};
  }

  function computeScore(day){
    return (day.checks || []).filter(Boolean).length;
  }

  function statusTag(score){
    if(score >= 5) return {txt:"æ»¡åˆ†", cls:"ok"};
    if(score >= 3) return {txt:"åˆæ ¼", cls:"warn"};
    if(score >= 1) return {txt:"èµ·æ­¥", cls:"warn"};
    return {txt:"æœªæ‰“å¡", cls:"bad"};
  }

  function setTag(el, tag){
    el.className = "tag " + tag.cls;
    el.textContent = tag.txt;
  }

  function calcStreak(all, todayKey){
    // streak: consecutive days ending at today with score>0
    let d = parseDate(todayKey);
    let streak = 0;
    while(true){
      const k = yyyy_mm_dd(d);
      const day = all[k];
      if(!day) break;
      if(computeScore(day) <= 0) break;
      streak += 1;
      d = addDays(d, -1);
    }
    return streak;
  }

  function weekStats(all, endKey){
    // last 7 days including endKey
    let d = parseDate(endKey);
    let total = 0;
    let bars = [];
    for(let i=0;i<7;i++){
      const k = yyyy_mm_dd(addDays(d, -6+i));
      const sc = all[k] ? computeScore(all[k]) : 0;
      total += sc;
      bars.push(sc);
    }
    return {total, bars};
  }

  function renderSpark(bars){
    const el = $("spark");
    el.innerHTML = "";
    for(let i=0;i<bars.length;i++){
      const b = document.createElement("div");
      b.className = "bar" + (bars[i] > 0 ? " on":"");
      b.style.height = (10 + bars[i]*6) + "px";
      b.title = `Day ${i+1}: ${bars[i]}/5`;
      el.appendChild(b);
    }
  }

  function setUIForKey(key){
    const day = getDay(key);
    $("todayLabel").textContent = key;

    const checks = day.checks || [false,false,false,false,false];
    ["c1","c2","c3","c4","c5"].forEach((id, idx) => { $(id).checked = !!checks[idx]; });

    const meta = day.meta || {};
    $("carbType").value = meta.carbType || "";
    $("postMeal").value = meta.postMeal || "";
    $("seaweed").value = meta.seaweed || "";
    $("water").value = meta.water ?? "";
    $("bedtime").value = meta.bedtime || "";
    $("coffee").value = meta.coffee ?? "";
    $("note").value = meta.note || "";

    const score = computeScore(day);
    $("score").textContent = `${score}/5`;
    setTag($("statusTag"), statusTag(score));

    const st = calcStreak(data, yyyy_mm_dd(new Date()));
    $("streak").textContent = `Streak: ${st}`;

    const wk = weekStats(data, key);
    $("weekScore").textContent = `${wk.total}/35`;
    renderSpark(wk.bars);
  }

  function collectDayFromUI(){
    return {
      checks: [
        $("c1").checked, $("c2").checked, $("c3").checked, $("c4").checked, $("c5").checked
      ],
      meta: {
        carbType: $("carbType").value,
        postMeal: $("postMeal").value,
        seaweed: $("seaweed").value,
        water: $("water").value ? Number($("water").value) : null,
        bedtime: $("bedtime").value,
        coffee: $("coffee").value ? Number($("coffee").value) : null,
        note: $("note").value
      },
      savedAt: new Date().toISOString()
    };
  }

  function saveCurrent(){
    const key = yyyy_mm_dd(cursor);
    data[key] = collectDayFromUI();
    saveAll(data);
    setUIForKey(key);
    toast("å·²ä¿å­˜ âœ…");
  }

  function toast(msg){
    const t = document.createElement("div");
    t.textContent = msg;
    t.style.position="fixed";
    t.style.left="50%";
    t.style.bottom="24px";
    t.style.transform="translateX(-50%)";
    t.style.padding="10px 12px";
    t.style.border="1px solid var(--line)";
    t.style.borderRadius="14px";
    t.style.background="#fff";
    t.style.boxShadow="0 6px 18px rgba(0,0,0,.08)";
    t.style.zIndex=9999;
    document.body.appendChild(t);
    setTimeout(()=>t.remove(), 1400);
  }

  // Navigation
  $("saveBtn").addEventListener("click", saveCurrent);
  $("prevBtn").addEventListener("click", () => { cursor = addDays(cursor, -1); setUIForKey(yyyy_mm_dd(cursor)); });
  $("nextBtn").addEventListener("click", () => { cursor = addDays(cursor,  1); setUIForKey(yyyy_mm_dd(cursor)); });
  $("todayBtn").addEventListener("click", () => { cursor = new Date(); setUIForKey(yyyy_mm_dd(cursor)); });

  // Export
  $("exportBtn").addEventListener("click", () => {
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "health-checkin-data.json";
    a.click();
    URL.revokeObjectURL(a.href);
  });

  // Import
  $("importBtn").addEventListener("click", () => $("fileInput").click());
  $("fileInput").addEventListener("change", async (e) => {
    const f = e.target.files[0];
    if(!f) return;
    try{
      const txt = await f.text();
      const obj = JSON.parse(txt);
      if(typeof obj !== "object" || Array.isArray(obj)) throw new Error("æ ¼å¼ä¸å¯¹");
      data = obj;
      saveAll(data);
      setUIForKey(yyyy_mm_dd(cursor));
      toast("å·²å¯¼å…¥ âœ…");
    }catch(err){
      alert("å¯¼å…¥å¤±è´¥ï¼š" + err.message);
    }finally{
      e.target.value = "";
    }
  });

  // Reset
  $("resetBtn").addEventListener("click", () => {
    if(confirm("ç¡®å®šæ¸…ç©ºæœ¬æœºæ‰€æœ‰æ‰“å¡æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")){
      data = {};
      saveAll(data);
      setUIForKey(yyyy_mm_dd(cursor));
      toast("å·²æ¸…ç©º");
    }
  });

  // PWA install
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js").catch(()=>{});
  }

  // Init
  setUIForKey(yyyy_mm_dd(cursor));
})();
</script>
  <div class="card" style="margin-top:16px">
  <h2>ğŸ½ï¸ ä¸çŸ¥é“åƒä»€ä¹ˆï¼Ÿï¼ˆå·¦å³æ»‘ï¼‰</h2>

  <div style="
    display:flex;
    gap:12px;
    overflow-x:auto;
    scroll-snap-type:x mandatory;
    padding-bottom:6px;
  ">
    <div class="pill" style="min-width:260px; scroll-snap-align:start">
      <strong>ä»Šå¤©å¾ˆç´¯</strong><br/>
      åŸç‰‡ç‡•éº¦ / çº¢è–¯ + é¸¡è›‹<br/>
      <span class="meta">ç¨³èƒ½é‡ã€ä¸çŠ¯å›°</span>
    </div>

    <div class="pill" style="min-width:260px; scroll-snap-align:start">
      <strong>æ’‘ä¸€ä¸‹åˆ</strong><br/>
      æ‚ç²®é¥­ + è›‹ç™½ + è”¬èœ<br/>
      <span class="meta">ä¸‹åˆæ›´å¹³ç¨³</span>
    </div>

    <div class="pill" style="min-width:260px; scroll-snap-align:start">
      <strong>ç¡æ™šä¿®å¤</strong><br/>
      çº¢è–¯ + è›‹ç™½ + æ¸©çƒ­èœ<br/>
      <span class="meta">å¯¹ç³»ç»Ÿæ¸©å’Œ</span>
    </div>

    <div class="pill" style="min-width:260px; scroll-snap-align:start">
      <strong>æƒ³åƒé¢</strong><br/>
      èéº¦é¢ï¼ˆåŠä»½ï¼‰+ è›‹ç™½<br/>
      <span class="meta">è§£é¦‹ä½†ä¸æ”¾å¤§æ³¢åŠ¨</span>
    </div>

    <div class="pill" style="min-width:260px; scroll-snap-align:start">
      <strong>èƒƒå£å·®</strong><br/>
      æ¸…æ±¤ + è›‹èŠ± / è±†è…<br/>
      <span class="meta">é¿å…èƒ½é‡å¡Œé™·</span>
    </div>

    <div class="pill" style="min-width:260px; scroll-snap-align:start">
      <strong>å¤–é£Ÿå…œåº•</strong><br/>
      æœ‰ä¸»é£Ÿ + æœ‰è›‹ç™½ + å°‘æ±¤<br/>
      <span class="meta">çœ‹èµ·æ¥ç¨³æœ€é‡è¦</span>
    </div>
  </div>
</div>
</body>
</html>
